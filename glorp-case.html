<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Glorp Case Opener</title>
    <style>
        :root {
            --primary-bg: #1a1c20; --secondary-bg: #2a2d32; --text-color: #e0e0e0;
            --accent-color: #4d88ff; --gold-color: #ffd700; --border-color: #444;
            --item-width: 150px; --item-height: 120px;
        }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: var(--primary-bg); color: var(--text-color); margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .container { width: 100%; max-width: 900px; }
        header { display: flex; justify-content: space-between; align-items: center; background-color: var(--secondary-bg); padding: 10px 20px; border-radius: 8px; border: 1px solid var(--border-color); margin-bottom: 20px; }
        h1 { margin: 0; color: var(--accent-color); }
        #balance-display { font-size: 1.5em; font-weight: bold; color: var(--gold-color); }
        .main-content { text-align: center; background-color: var(--secondary-bg); padding: 30px; border-radius: 8px; border: 1px solid var(--border-color); margin-bottom: 20px;}
        .case-container img { max-width: 200px; height: 200px; object-fit: contain; margin-bottom: 20px; }
        .button-group { display: flex; justify-content: center; align-items:center; gap: 15px; }
        .btn { color: white; border: none; padding: 15px 30px; font-size: 1.2em; font-weight: bold; border-radius: 5px; cursor: pointer; transition: background-color 0.2s; text-decoration: none; display: inline-block; }
        #open-case-btn { background-color: var(--accent-color); }
        #open-case-btn:hover { background-color: #3a70e0; }
        #open-case-btn:disabled { background-color: #555; cursor: not-allowed; }
        #back-btn, #show-chances-btn { background-color: #6c757d; font-size: 1em; padding: 10px 20px;}
        #back-btn:hover, #show-chances-btn:hover { background-color: #5a6268; }
        
        /* --- Modals --- */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.8); display: none; justify-content: center; align-items: center; z-index: 1000; }
        #spinner-modal { background-color: rgba(0, 0, 0, 0.9); flex-direction: column; }
        .spinner-window { width: 90%; max-width: 1200px; height: var(--item-height); background-color: var(--primary-bg); border: 2px solid var(--border-color); border-radius: 5px; overflow: hidden; position: relative; }
        .spinner-marker { position: absolute; top: -2px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 10px solid transparent; border-right: 10px solid transparent; border-top: 15px solid var(--accent-color); z-index: 10; }
        #spinner-reel { display: flex; height: 100%; transition: transform 3.5s cubic-bezier(0.1, 0.6, 0.3, 1); }
        .spinner-item { width: var(--item-width); height: 100%; flex-shrink: 0; display: flex; flex-direction: column; justify-content: center; align-items: center; background-color: var(--secondary-bg); box-sizing: border-box; border-right: 2px solid var(--primary-bg); }
        .spinner-item img { max-width: 90%; max-height: 70%; object-fit: contain; }
        .spinner-item .item-name { font-size: 0.8em; margin-top: 5px; }
        .modal-content { background-color: var(--secondary-bg); padding: 30px; border-radius: 10px; text-align: center; border: 2px solid var(--accent-color); animation: fadeIn 0.5s; max-height: 80vh; overflow-y: auto; position: relative; }
        .modal-content h2, .modal-content h3 { margin-top: 0; }
        .modal-content img { max-width: 250px; height: 250px; object-fit: contain; margin-bottom: 20px; }
        #chances-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        #chances-table th, #chances-table td { padding: 12px; text-align: left; border-bottom: 1px solid var(--border-color); }
        #chances-table img { width: 40px; height: 40px; vertical-align: middle; margin-right: 10px;}
        .close-modal-btn { position: absolute; top: 15px; right: 20px; font-size: 2em; color: #aaa; cursor: pointer; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }
    </style>
</head>
<body>
    <div class="container">
        <header><h1>Glorp Case</h1><div id="balance-display">0 glorpies</div></header>
        <div class="main-content">
            <div class="case-container"><img src="case.png" alt="Glorp Case" id="case-image"></div>
            <div class="button-group">
                <a href="case-opener.html" id="back-btn" class="btn">Back to Menu</a>
                <button id="open-case-btn" class="btn">Open Case (Free)</button>
                <button id="show-chances-btn" class="btn">Show Chances</button>
            </div>
        </div>
    </div>
    <div id="spinner-modal" class="modal"><div class="spinner-window"><div class="spinner-marker"></div><div id="spinner-reel"></div></div></div>
    <div id="result-modal" class="modal"><div class="modal-content"><h2>You've unboxed:</h2><h3 id="result-item-name"></h3><img id="result-item-img" src="" alt="Won Item"><div id="result-item-value" class="item-value"></div><p>Click anywhere outside to close.</p></div></div>
    <div id="chances-modal" class="modal"><div class="modal-content"><span class="close-modal-btn" data-modal-id="chances-modal">×</span><h2>Case Drop Chances</h2><table id="chances-table"><tbody id="chances-table-body"></tbody></table></div></div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- KONFIGURACJA SZANS (Edytuj tutaj!) ---
        const USE_CUSTOM_CHANCES = true; // Ustaw na 'true', aby użyć poniższych szans. Ustaw na 'false', aby wrócić do domyślnych (opartych na wartości).

        // Jeśli USE_CUSTOM_CHANCES jest 'true', edytuj te wartości.
        // WAŻNE: Upewnij się, że suma wartości procentowych wynosi dokładnie 100!
        const CUSTOM_CHANCES = {
            'Glorp-10.png':           34.36,
            'Glorp-Jam-15.gif':       22.91,
            'Bday-Glorp-30.gif':      11.45,
            'Christmas-Glorp-45.png': 7.63,
            'Glorpium-50.png':        6.87,
            'Glorp-Cheer-50.gif':     6.87,
            'Glorp-Feet-75.gif':      5.33,
            'Rainbow-Glorp-100.gif':  4.58
        };
        // ---------------------------------------------

        const FOLDER_PATH = '';
        const COOKIE_NAME = 'glorpPlayerData_v8';
        const SECRET_KEY = 5;

        const itemFilenames = [ 'Glorp-10.png', 'Glorp-Jam-15.gif', 'Bday-Glorp-30.gif', 'Christmas-Glorp-45.png', 'Glorpium-50.png', 'Glorp-Cheer-50.gif', 'Glorp-Feet-75.gif', 'Rainbow-Glorp-100.gif' ];
        let playerData = { glorpies: 100, inventory: [] };
        let caseItems = [], totalWeight = 0;

        const openCaseBtn = document.getElementById('open-case-btn');
        const balanceDisplay = document.getElementById('balance-display');
        const spinnerModal = document.getElementById('spinner-modal');
        const spinnerReel = document.getElementById('spinner-reel');
        const resultModal = document.getElementById('result-modal');
        const chancesModal = document.getElementById('chances-modal');
        
        // --- DATA ENCODING/DECODING (unchanged) ---
        function encodeData(data) { try { let jsonString = JSON.stringify(data); let s = ''; for (let i=0; i<jsonString.length; i++) s+=String.fromCharCode(jsonString.charCodeAt(i)+SECRET_KEY); return btoa(s); } catch(e){return '';}}
        function decodeData(encoded) { try { let s = atob(encoded); let j = ''; for (let i=0; i<s.length; i++) j+=String.fromCharCode(s.charCodeAt(i)-SECRET_KEY); return JSON.parse(j); } catch(e){return null;}}
        
        const setCookie = (name, data, days) => { const encoded = encodeData(data); let d=new Date(); d.setTime(d.getTime()+(days*24*60*60*1000)); document.cookie = `${name}=${encoded};expires=${d.toUTCString()};path=/;SameSite=Lax`; };
        const getCookie = name => { const c=document.cookie.split(';').find(r=>r.trim().startsWith(name+'=')); return c ? decodeData(c.split('=')[1]) : null; };
        
        const parseValue = f => parseInt((f.match(/(\d+)\.(png|gif)$/i) || [])[1] || 0, 10);
        const parseName = f => { const p = f.replace(/\.(png|gif)$/i, '').split('-'); p.pop(); return p.map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' '); };
        const formatGlorpies = n => n.toLocaleString('en-US') + ' glorpies';

        function initializeCaseItems() {
            const itemsData = itemFilenames.map(f => ({
                filename: f,
                name: parseName(f),
                value: parseValue(f)
            })).filter(i => i.value > 0);
            
            if (USE_CUSTOM_CHANCES) {
                const totalCustomChance = Object.values(CUSTOM_CHANCES).reduce((sum, chance) => sum + chance, 0);
                if (Math.abs(totalCustomChance - 100) > 0.001) {
                    console.error(`BŁĄD KONFIGURACJI: Suma szans w CUSTOM_CHANCES wynosi ${totalCustomChance}%, a powinna wynosić 100%. Losowanie może nie działać poprawnie.`);
                }
                
                totalWeight = 100;
                caseItems = itemsData.map(item => {
                    const probability = CUSTOM_CHANCES[item.filename] || 0;
                    return { ...item, probability: probability, weight: probability };
                });
            } else {
                // Default logic (based on item value)
                const itemsWithWeights = itemsData.map(item => ({ ...item, weight: 1 / item.value }));
                totalWeight = itemsWithWeights.reduce((sum, item) => sum + item.weight, 0);
                caseItems = itemsWithWeights.map(item => ({
                    ...item,
                    probability: totalWeight > 0 ? (item.weight / totalWeight) * 100 : 0
                }));
            }
            populateChancesModal();
        }

        function selectWeightedItem() {
            const r = Math.random() * totalWeight; 
            let cumulativeWeight = 0;
            for (const item of caseItems) {
                cumulativeWeight += item.weight;
                if (r < cumulativeWeight) return item;
            }
            return caseItems[caseItems.length - 1]; // Fallback
        }
        
        function loadPlayerData() { const saved = getCookie(COOKIE_NAME); if (saved) playerData = saved; updateUI(); }
        function savePlayerData() { setCookie(COOKIE_NAME, playerData, 365); }
        function updateUI() { balanceDisplay.textContent = formatGlorpies(playerData.glorpies); }
        function showResult(item) { document.getElementById('result-item-name').textContent = item.name; document.getElementById('result-item-img').src = FOLDER_PATH + item.filename; document.getElementById('result-item-value').textContent = `Value: ${formatGlorpies(item.value)}`; resultModal.style.display = 'flex'; }

        function runOpeningAnimation(wonItem) { const reel = []; const REEL_LENGTH=50, WINNING_INDEX=REEL_LENGTH-5; for(let i=0;i<REEL_LENGTH;i++) reel.push(i===WINNING_INDEX?wonItem:caseItems[Math.floor(Math.random()*caseItems.length)]); spinnerReel.innerHTML = reel.map(item => `<div class="spinner-item"><img src="${FOLDER_PATH+item.filename}" alt="${item.name}"><div class="item-name">${item.name}</div></div>`).join(''); spinnerModal.style.display='flex'; spinnerReel.style.transition='none'; spinnerReel.style.transform='translateX(0)'; spinnerReel.offsetHeight; const itemWidth=150, windowCenter=document.querySelector('.spinner-window').offsetWidth/2; let targetPosition=-(WINNING_INDEX*itemWidth)+windowCenter-(itemWidth/2)+(Math.random()-0.5)*(itemWidth*0.6); spinnerReel.style.transition='transform 3.5s cubic-bezier(0.1, 0.6, 0.3, 1)'; spinnerReel.style.transform=`translateX(${targetPosition}px)`; setTimeout(()=>{ spinnerModal.style.display='none'; playerData.inventory.push({filename: wonItem.filename, locked: false}); savePlayerData(); updateUI(); showResult(wonItem); openCaseBtn.disabled=false; },4000); }

        openCaseBtn.addEventListener('click', () => { if(caseItems.length===0){alert('Error: No items configured.'); return;} openCaseBtn.disabled=true; const wonItem = selectWeightedItem(); runOpeningAnimation(wonItem); });
        document.getElementById('show-chances-btn').addEventListener('click', () => { chancesModal.style.display = 'flex'; });
        document.querySelectorAll('.modal').forEach(m => { m.addEventListener('click', e => { if(e.target===m) m.style.display='none'; }); });
        document.querySelectorAll('.close-modal-btn').forEach(b => { b.addEventListener('click', () => { document.getElementById(b.dataset.modalId).style.display = 'none'; }); });
        function populateChancesModal() { const s=[...caseItems].sort((a,b)=>b.probability-a.probability); document.getElementById('chances-table-body').innerHTML = s.map(i=>`<tr><td><img src="${FOLDER_PATH+i.filename}" alt="${i.name}"></td><td>${i.name}</td><td>${formatGlorpies(i.value)}</td><td>${i.probability<0.001?'<0.001%':i.probability.toFixed(4)+'%'}</td></tr>`).join(''); }
        
        initializeCaseItems();
        loadPlayerData();
    });
    </script>
</body>
</html>
