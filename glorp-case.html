<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Glorp Case Opener.</title>
    <style>
        :root {
            --primary-bg: #1a1c20; --secondary-bg: #2a2d32; --text-color: #e0e0e0;
            --accent-color: #4d88ff; --gold-color: #ffd700; --border-color: #444;
            --item-width: 150px; --item-height: 120px;
        }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: var(--primary-bg); color: var(--text-color); margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .container { width: 100%; max-width: 900px; }
        header { display: flex; justify-content: space-between; align-items: center; background-color: var(--secondary-bg); padding: 10px 20px; border-radius: 8px; border: 1px solid var(--border-color); margin-bottom: 20px; }
        h1 { margin: 0; color: var(--accent-color); }
        #balance-display { font-size: 1.5em; font-weight: bold; color: var(--gold-color); }
        .main-content { text-align: center; background-color: var(--secondary-bg); padding: 30px; border-radius: 8px; border: 1px solid var(--border-color); }
        .case-container img { max-width: 200px; height: 200px; object-fit: contain; margin-bottom: 20px; }
        .button-group { display: flex; justify-content: center; align-items:center; gap: 15px; }
        .btn { color: white; border: none; padding: 15px 30px; font-size: 1.2em; font-weight: bold; border-radius: 5px; cursor: pointer; transition: background-color 0.2s; text-decoration: none; display: inline-block; }
        #open-case-btn { background-color: var(--accent-color); }
        #open-case-btn:hover { background-color: #3a70e0; }
        #open-case-btn:disabled { background-color: #555; cursor: not-allowed; }
        #back-btn, #show-chances-btn { background-color: #6c757d; font-size: 1em; padding: 10px 20px;}
        #back-btn:hover, #show-chances-btn:hover { background-color: #5a6268; }
        .inventory-section { margin-top: 30px; }
        #inventory-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 15px; background-color: var(--secondary-bg); padding: 20px; border-radius: 8px; border: 1px solid var(--border-color); min-height: 150px; }
        .inventory-item { background-color: var(--primary-bg); border: 1px solid var(--border-color); border-radius: 8px; padding: 10px; text-align: center; display: flex; flex-direction: column; justify-content: space-between; }
        .inventory-item img { max-width: 100px; height: 80px; object-fit: contain; margin: 0 auto 10px; }
        .item-name { font-weight: bold; font-size: 1em; margin-bottom: 5px; word-wrap: break-word; }
        .item-value { font-size: 0.9em; color: var(--gold-color); margin-bottom: 10px; }
        .sell-btn { background-color: #e64c4c; color: white; border: none; padding: 8px 12px; font-size: 0.9em; border-radius: 5px; cursor: pointer; width: 100%; }
        .sell-btn:hover { background-color: #c0392b; }
        #spinner-modal { background-color: rgba(0, 0, 0, 0.9); flex-direction: column; }
        .spinner-window { width: 90%; max-width: 1200px; height: var(--item-height); background-color: var(--primary-bg); border: 2px solid var(--border-color); border-radius: 5px; overflow: hidden; position: relative; }
        .spinner-marker { position: absolute; top: -2px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 10px solid transparent; border-right: 10px solid transparent; border-top: 15px solid var(--accent-color); z-index: 10; }
        #spinner-reel { display: flex; height: 100%; transition: transform 3.5s cubic-bezier(0.1, 0.6, 0.3, 1); }
        .spinner-item { width: var(--item-width); height: 100%; flex-shrink: 0; display: flex; flex-direction: column; justify-content: center; align-items: center; background-color: var(--secondary-bg); box-sizing: border-box; border-right: 2px solid var(--primary-bg); }
        .spinner-item img { max-width: 90%; max-height: 70%; object-fit: contain; }
        .spinner-item .item-name { font-size: 0.8em; margin-top: 5px; }
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.8); display: none; justify-content: center; align-items: center; z-index: 1000; }
        .modal-content { background-color: var(--secondary-bg); padding: 30px; border-radius: 10px; text-align: center; border: 2px solid var(--accent-color); animation: fadeIn 0.5s; max-height: 80vh; overflow-y: auto; }
        .modal-content h2, .modal-content h3 { margin-top: 0; }
        .modal-content img { max-width: 250px; height: 250px; object-fit: contain; margin-bottom: 20px; }
        #chances-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        #chances-table th, #chances-table td { padding: 12px; text-align: left; border-bottom: 1px solid var(--border-color); }
        #chances-table th { background-color: var(--primary-bg); }
        #chances-table img { width: 40px; height: 40px; vertical-align: middle; margin-right: 10px;}
        .close-modal-btn { position: absolute; top: 15px; right: 20px; font-size: 2em; color: #aaa; cursor: pointer; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>Glorp Case</h1> <!-- Możesz dynamicznie zmieniać tę nazwę w przyszłości -->
            <div id="balance-display">0 glorpies</div>
        </header>

        <div class="main-content">
            <div class="case-container">
                <img src="case.png" alt="Glorp Case" id="case-image">
            </div>
            <div class="button-group">
                <a href="case-opener.html" id="back-btn" class="btn">Back to Menu</a> <!-- NOWY PRZYCISK POWROTU -->
                <button id="open-case-btn" class="btn">Open Case (Free)</button>
                <button id="show-chances-btn" class="btn">Show Chances</button>
            </div>
        </div>

        <div class="inventory-section">
            <h2>Inventory</h2>
            <div id="inventory-grid"></div>
        </div>
    </div>
    
    <div id="spinner-modal" class="modal"><div class="spinner-window"><div class="spinner-marker"></div><div id="spinner-reel"></div></div></div>
    <div id="result-modal" class="modal"><div class="modal-content"><h2>You've unboxed:</h2><h3 id="result-item-name"></h3><img id="result-item-img" src="" alt="Won Item"><div id="result-item-value" class="item-value"></div><p>Click anywhere outside to close.</p></div></div>
    <div id="chances-modal" class="modal"><div class="modal-content"><span class="close-modal-btn" data-modal-id="chances-modal">×</span><h2>Case Drop Chances</h2><table id="chances-table"><tbody id="chances-table-body"></tbody></table></div></div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const FOLDER_PATH = '';
        const COOKIE_NAME = 'glorpPlayerData_v6'; // Używamy tej samej nazwy cookie co w menu

        // Konfiguracja przedmiotów dla TEJ KONKRETNEJ skrzynki
        const itemFilenames = [
            'Glorp-10.png', 'Glorp-Jam-15.gif', 'Bday-Glorp-30.gif', 'Christmas-Glorp-45.png'
        ];

        let playerData = { glorpies: 100, inventory: [] };
        let caseItems = [];
        let totalWeight = 0;

        const openCaseBtn = document.getElementById('open-case-btn');
        const balanceDisplay = document.getElementById('balance-display');
        const inventoryGrid = document.getElementById('inventory-grid');
        const spinnerModal = document.getElementById('spinner-modal');
        const spinnerReel = document.getElementById('spinner-reel');
        const resultModal = document.getElementById('result-modal');
        const chancesModal = document.getElementById('chances-modal');
        
        const parseValue = f => parseInt((f.match(/(\d+)\.(png|gif)$/i) || [])[1] || 0, 10);
        const parseName = f => { const parts = f.replace(/\.(png|gif)$/i, '').split('-'); parts.pop(); return parts.map(p => p.charAt(0).toUpperCase() + p.slice(1)).join(' '); };
        const formatGlorpies = n => n.toLocaleString('en-US') + ' glorpies';

        function initializeCaseItems() {
            const itemsWithWeights = itemFilenames.map(filename => { const value = parseValue(filename); if (value === 0) return null; return { filename, name: parseName(filename), value, weight: 1 / value }; }).filter(Boolean);
            totalWeight = itemsWithWeights.reduce((sum, item) => sum + item.weight, 0);
            caseItems = itemsWithWeights.map(item => ({ ...item, probability: (item.weight / totalWeight) * 100 }));
        }

        function selectWeightedItem() {
            const random = Math.random() * totalWeight;
            let currentWeight = 0;
            for (const item of caseItems) { currentWeight += item.weight; if (random < currentWeight) return item; }
            return caseItems[caseItems.length - 1];
        }

        const setCookie = (n, v, d) => { let e = new Date(); e.setTime(e.getTime() + (d * 864e5)); document.cookie = `${n}=${JSON.stringify(v)};expires=${e.toUTCString()};path=/;SameSite=Lax`; };
        const getCookie = n => { const c = document.cookie.split(';').find(r => r.trim().startsWith(n + '=')); if(c) try { return JSON.parse(c.split('=')[1]); } catch(e){ return null; } return null; };
        
        function loadPlayerData() { const saved = getCookie(COOKIE_NAME); if (saved) playerData = saved; updateUI(); }
        function savePlayerData() { setCookie(COOKIE_NAME, playerData, 365); }
        function updateUI() {
            balanceDisplay.textContent = formatGlorpies(playerData.glorpies);
            inventoryGrid.innerHTML = playerData.inventory.length === 0 ? '<p style="color: #888; text-align: center; width: 100%;">Your inventory is empty.</p>' : playerData.inventory.map((f, i) => `<div class="inventory-item"><img src="${FOLDER_PATH}${f}" alt="${parseName(f)}"><p class="item-name">${parseName(f)}</p><p class="item-value">${formatGlorpies(parseValue(f))}</p><button class="sell-btn" data-index="${i}">Sell</button></div>`).join('');
        }
        function showResult(item) {
            document.getElementById('result-item-name').textContent = item.name;
            document.getElementById('result-item-img').src = FOLDER_PATH + item.filename;
            document.getElementById('result-item-value').textContent = `Value: ${formatGlorpies(item.value)}`;
            resultModal.style.display = 'flex';
        }

        function runOpeningAnimation(wonItem) {
            const reel = []; const REEL_LENGTH = 50; const WINNING_INDEX = REEL_LENGTH - 5;
            for (let i = 0; i < REEL_LENGTH; i++) { reel.push(i === WINNING_INDEX ? wonItem : caseItems[Math.floor(Math.random() * caseItems.length)]); }
            spinnerReel.innerHTML = reel.map(item => `<div class="spinner-item"><img src="${FOLDER_PATH}${item.filename}" alt="${item.name}"><div class="item-name">${item.name}</div></div>`).join('');
            spinnerModal.style.display = 'flex';
            spinnerReel.style.transition = 'none';
            spinnerReel.style.transform = 'translateX(0)';
            spinnerReel.offsetHeight; 
            const itemWidth = 150; const windowCenter = document.querySelector('.spinner-window').offsetWidth / 2;
            let targetPosition = -(WINNING_INDEX * itemWidth) + windowCenter - (itemWidth / 2) + (Math.random() - 0.5) * (itemWidth * 0.6);
            spinnerReel.style.transition = 'transform 3.5s cubic-bezier(0.1, 0.6, 0.3, 1)';
            spinnerReel.style.transform = `translateX(${targetPosition}px)`;
            setTimeout(() => {
                spinnerModal.style.display = 'none';
                playerData.inventory.push(wonItem.filename);
                savePlayerData();
                updateUI();
                showResult(wonItem);
                openCaseBtn.disabled = false;
            }, 4000);
        }

        openCaseBtn.addEventListener('click', () => {
            if (caseItems.length === 0) { alert('Error: No items configured.'); return; }
            openCaseBtn.disabled = true;
            const wonItem = selectWeightedItem();
            runOpeningAnimation(wonItem);
        });
        
        inventoryGrid.addEventListener('click', e => { if (e.target.classList.contains('sell-btn')) { const i = parseInt(e.target.dataset.index, 10); const f = playerData.inventory[i]; if(f){ playerData.glorpies += parseValue(f); playerData.inventory.splice(i, 1); savePlayerData(); updateUI(); } } });
        document.getElementById('show-chances-btn').addEventListener('click', () => { chancesModal.style.display = 'flex'; });
        document.querySelectorAll('.modal').forEach(m => { m.addEventListener('click', e => { if (e.target === m) m.style.display = 'none'; }); });
        document.querySelectorAll('.close-modal-btn').forEach(b => { b.addEventListener('click', () => { document.getElementById(b.dataset.modalId).style.display = 'none'; }); });
        function populateChancesModal() { const s = [...caseItems].sort((a,b)=>a.probability-b.probability); document.getElementById('chances-table-body').innerHTML = s.map(i=>`<tr><td><img src="${FOLDER_PATH+i.filename}" alt="${i.name}"></td><td>${i.name}</td><td>${formatGlorpies(i.value)}</td><td>${i.probability<0.001?'<0.001%':i.probability.toFixed(4)+'%'}</td></tr>`).join(''); }

        initializeCaseItems();
        populateChancesModal();
        loadPlayerData();
    });
    </script>
</body>
</html>
