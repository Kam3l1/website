<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Glorp Case Opener </title>
    <style>
        :root {
            --primary-bg: #1a1c20;
            --secondary-bg: #2a2d32;
            --text-color: #e0e0e0;
            --accent-color: #4d88ff;
            --gold-color: #ffd700;
            --border-color: #444;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--primary-bg);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container { width: 100%; max-width: 900px; }

        header {
            display: flex; justify-content: space-between; align-items: center;
            background-color: var(--secondary-bg); padding: 10px 20px; border-radius: 8px;
            border: 1px solid var(--border-color); margin-bottom: 20px;
        }

        h1 { margin: 0; color: var(--accent-color); }
        #balance-display { font-size: 1.5em; font-weight: bold; color: var(--gold-color); }

        .main-content { text-align: center; background-color: var(--secondary-bg); padding: 30px; border-radius: 8px; border: 1px solid var(--border-color); }
        .case-container img { max-width: 200px; height: 200px; object-fit: contain; margin-bottom: 20px; transition: transform 0.2s ease-in-out; }
        .case-container img:hover { transform: scale(1.05); }
        
        .button-group { display: flex; justify-content: center; gap: 15px; }

        .btn {
            color: white; border: none; padding: 15px 30px; font-size: 1.2em; font-weight: bold;
            border-radius: 5px; cursor: pointer; transition: background-color 0.2s;
        }
        #open-case-btn { background-color: var(--accent-color); }
        #open-case-btn:hover { background-color: #3a70e0; }
        #open-case-btn:disabled { background-color: #555; cursor: not-allowed; }
        
        #show-chances-btn { background-color: #6c757d; font-size: 1em; padding: 10px 20px;}
        #show-chances-btn:hover { background-color: #5a6268; }

        .inventory-section { margin-top: 30px; }
        #inventory-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 15px;
            background-color: var(--secondary-bg); padding: 20px; border-radius: 8px;
            border: 1px solid var(--border-color); min-height: 150px;
        }

        .inventory-item {
            background-color: var(--primary-bg); border: 1px solid var(--border-color); border-radius: 8px;
            padding: 10px; text-align: center; display: flex; flex-direction: column; justify-content: space-between;
        }
        .inventory-item img { max-width: 100px; height: 80px; object-fit: contain; margin: 0 auto 10px; }
        .item-name { font-weight: bold; font-size: 1em; margin-bottom: 5px; word-wrap: break-word; }
        .item-value { font-size: 0.9em; color: var(--gold-color); margin-bottom: 10px; }
        .sell-btn {
            background-color: #e64c4c; color: white; border: none; padding: 8px 12px;
            font-size: 0.9em; border-radius: 5px; cursor: pointer; width: 100%;
        }
        .sell-btn:hover { background-color: #c0392b; }

        /* Modal Styles */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.8); display: none;
            justify-content: center; align-items: center; z-index: 1000;
        }
        .modal-content {
            background-color: var(--secondary-bg); padding: 30px; border-radius: 10px;
            text-align: center; border: 2px solid var(--accent-color);
            animation: fadeIn 0.5s; max-height: 80vh; overflow-y: auto;
        }
        .modal-content h2, .modal-content h3 { margin-top: 0; }
        .modal-content img { max-width: 250px; height: 250px; object-fit: contain; margin-bottom: 20px; }
        
        #chances-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        #chances-table th, #chances-table td { padding: 12px; text-align: left; border-bottom: 1px solid var(--border-color); }
        #chances-table th { background-color: var(--primary-bg); }
        #chances-table img { width: 40px; height: 40px; vertical-align: middle; margin-right: 10px;}
        .close-modal-btn { position: absolute; top: 15px; right: 20px; font-size: 2em; color: #aaa; cursor: pointer; }
        
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>Glorp Case</h1>
            <div id="balance-display">0 glorpies</div>
        </header>

        <div class="main-content">
            <h2>Glorp Case (Free)</h2>
            <div class="case-container">
                <!-- ZMIANA TUTAJ: Usunięto 'glorp-case/' ze ścieżki -->
                <img src="case.png" alt="Glorp Case" id="case-image">
            </div>
            <div class="button-group">
                <button id="open-case-btn" class="btn">Open Case</button>
                <button id="show-chances-btn" class="btn">Show Chances</button>
            </div>
        </div>

        <div class="inventory-section">
            <h2>Inventory</h2>
            <div id="inventory-grid"></div>
        </div>
    </div>
    
    <!-- Result Modal -->
    <div id="result-modal" class="modal">
        <div class="modal-content">
            <h2>You've unboxed:</h2>
            <h3 id="result-item-name"></h3>
            <img id="result-item-img" src="" alt="Won Item">
            <div id="result-item-value" class="item-value"></div>
            <p>Click anywhere outside to close.</p>
        </div>
    </div>

    <!-- Chances Modal -->
    <div id="chances-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal-btn" data-modal-id="chances-modal">×</span>
            <h2>Case Drop Chances</h2>
            <p>Rarer items have a lower chance of being unboxed.</p>
            <table id="chances-table">
                <thead>
                    <tr><th>Item</th><th>Name</th><th>Value</th><th>Chance</th></tr>
                </thead>
                <tbody id="chances-table-body">
                    <!-- Chances will be populated by JS -->
                </tbody>
            </table>
        </div>
    </div>


    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // ZMIANA TUTAJ: Ścieżka jest teraz pusta, bo pliki są w tym samym folderze
        const FOLDER_PATH = '';
        const COOKIE_NAME = 'glorpPlayerData_v4'; // Zmieniona nazwa cookie, aby uniknąć konfliktów

        const itemFilenames = [
            'Glorp-10.png',
            'Glorp-Jam-15.gif',
            'Bday-Glorp-30.gif',
            'Christmas-Glorp-45.png'
        ];

        let playerData = { glorpies: 100, inventory: [] };
        let caseItems = [];
        let totalWeight = 0;

        const balanceDisplay = document.getElementById('balance-display');
        const openCaseBtn = document.getElementById('open-case-btn');
        const showChancesBtn = document.getElementById('show-chances-btn');
        const inventoryGrid = document.getElementById('inventory-grid');
        const resultModal = document.getElementById('result-modal');
        const resultItemImg = document.getElementById('result-item-img');
        const resultItemName = document.getElementById('result-item-name');
        const resultItemValue = document.getElementById('result-item-value');
        const chancesModal = document.getElementById('chances-modal');
        const chancesTableBody = document.getElementById('chances-table-body');

        const parseValue = f => parseInt((f.match(/(\d+)\.(png|gif)$/i) || [])[1] || 0, 10);
        const parseName = f => { const parts = f.replace(/\.(png|gif)$/i, '').split('-'); parts.pop(); return parts.map(p => p.charAt(0).toUpperCase() + p.slice(1)).join(' '); };
        const formatGlorpies = n => n.toLocaleString('en-US') + ' glorpies';

        function initializeCaseItems() {
            const itemsWithWeights = itemFilenames.map(filename => { const value = parseValue(filename); if (value === 0) return null; return { filename, name: parseName(filename), value, weight: 1 / value }; }).filter(Boolean);
            totalWeight = itemsWithWeights.reduce((sum, item) => sum + item.weight, 0);
            caseItems = itemsWithWeights.map(item => ({ ...item, probability: (item.weight / totalWeight) * 100 }));
        }

        function selectWeightedItem() {
            const random = Math.random() * totalWeight;
            let currentWeight = 0;
            for (const item of caseItems) { currentWeight += item.weight; if (random < currentWeight) return item; }
            return caseItems[caseItems.length - 1];
        }

        const setCookie = (name, val, days) => { let d = new Date(); d.setTime(d.getTime() + (days * 24 * 60 * 60 * 1000)); document.cookie = `${name}=${JSON.stringify(val)};expires=${d.toUTCString()};path=/;SameSite=Lax`; };
        const getCookie = name => { const c = document.cookie.split(';').find(row => row.trim().startsWith(name + '=')); if (c) try { return JSON.parse(c.split('=')[1]); } catch(e) { return null; } return null; };

        function loadPlayerData() { const savedData = getCookie(COOKIE_NAME); if (savedData) playerData = savedData; updateUI(); }
        function savePlayerData() { setCookie(COOKIE_NAME, playerData, 365); }

        function updateUI() {
            balanceDisplay.textContent = formatGlorpies(playerData.glorpies);
            inventoryGrid.innerHTML = '';
            if (playerData.inventory.length === 0) {
                inventoryGrid.innerHTML = '<p style="color: #888; text-align: center; width: 100%;">Your inventory is empty.</p>';
            } else {
                playerData.inventory.forEach((filename, index) => {
                    inventoryGrid.innerHTML += `<div class="inventory-item"><img src="${FOLDER_PATH}${filename}" alt="${parseName(filename)}"><p class="item-name">${parseName(filename)}</p><p class="item-value">${formatGlorpies(parseValue(filename))}</p><button class="sell-btn" data-index="${index}">Sell</button></div>`;
                });
            }
        }
        
        function showResult(item) { resultItemImg.src = FOLDER_PATH + item.filename; resultItemName.textContent = item.name; resultItemValue.textContent = `Value: ${formatGlorpies(item.value)}`; resultModal.style.display = 'flex'; }
        
        function populateChancesModal() {
            chancesTableBody.innerHTML = '';
            const sortedItems = [...caseItems].sort((a, b) => a.probability - b.probability);
            sortedItems.forEach(item => { const chance = item.probability < 0.001 ? '< 0.001%' : item.probability.toFixed(4) + '%'; chancesTableBody.innerHTML += `<tr><td><img src="${FOLDER_PATH}${item.filename}" alt="${item.name}"></td><td>${item.name}</td><td>${formatGlorpies(item.value)}</td><td>${chance}</td></tr>`; });
        }

        openCaseBtn.addEventListener('click', () => {
            if (caseItems.length === 0) { alert('Error: No items configured.'); return; }
            openCaseBtn.disabled = true; let spinCount = 0; const caseImage = document.getElementById('case-image');
            const spinInterval = setInterval(() => {
                caseImage.src = FOLDER_PATH + caseItems[Math.floor(Math.random() * caseItems.length)].filename;
                if (++spinCount > 15) {
                    clearInterval(spinInterval); const wonItem = selectWeightedItem();
                    caseImage.src = FOLDER_PATH + 'case.png'; playerData.inventory.push(wonItem.filename);
                    savePlayerData(); updateUI(); showResult(wonItem); openCaseBtn.disabled = false;
                }
            }, 100);
        });

        inventoryGrid.addEventListener('click', e => {
            if (e.target.classList.contains('sell-btn')) {
                const index = parseInt(e.target.dataset.index, 10);
                const filename = playerData.inventory[index];
                if (filename) { playerData.glorpies += parseValue(filename); playerData.inventory.splice(index, 1); savePlayerData(); updateUI(); }
            }
        });
        
        showChancesBtn.addEventListener('click', () => { chancesModal.style.display = 'flex'; });
        document.querySelectorAll('.modal').forEach(modal => { modal.addEventListener('click', e => { if (e.target === modal) modal.style.display = 'none'; }); });
        document.querySelectorAll('.close-modal-btn').forEach(btn => { btn.addEventListener('click', () => { document.getElementById(btn.dataset.modalId).style.display = 'none'; }); });

        initializeCaseItems();
        populateChancesModal();
        loadPlayerData();
    });
    </script>
</body>
</html>
